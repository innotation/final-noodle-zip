<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
  <div th:replace="~{fragments/head :: head}"></div>

  <!-- SPECIFIC CSS -->
  <link href="/css/submit.css" rel="stylesheet">
  <link href="/css/detail-page-delivery.css" rel="stylesheet">
  <link href="/css/booking-sign_up.css" rel="stylesheet">

  <!-- YOUR CUSTOM CSS -->
  <link href="/css/store-regist.css" rel="stylesheet">

</head>

<body class="margin_sticky">


  <!-- /header -->
  <header th:replace="~{fragments/subHeader :: subHeader}"></header>

  <main class="bg_gray pattern">
    <div class="container margin_60_40">
      <div class="row justify-content-center">
        <div class="col-xl-6 col-lg-8">

          <!-- form íƒœê·¸ ì‹œì‘ -->
          <form method="post" action="/store/regist" enctype="multipart/form-data" id="register" autocomplete="off">

            <div class="box_booking_2 style_2">

              <div class="head">
                <div class="title">
                  <h3>ê°€ê²Œ ë“±ë¡</h3>
                </div>
              </div>

              <div class="main">

                <!-- â‘  ì´ë¯¸ì§€ ì—…ë¡œë“œ -->
                <label for="image-input" id="image-upload-area"
                       style="border: 2px dashed #ccc; padding: 40px 30px; text-align: center; cursor: pointer; display: flex; flex-direction: column; align-items: center;">
                  <span id="upload-text">Drop files here to upload</span>
                  <img id="preview-image" src="" alt="ì—…ë¡œë“œ ë¯¸ë¦¬ë³´ê¸° ì´ë¯¸ì§€"
                       style="max-width: 100%; display: none; margin-top: 10px;"/>
                </label>

                <input type="file" id="image-input" name="storeMainImage" accept="image/*"
                       style="opacity: 0; position: absolute; width: 0; height: 0;"/>

                <!-- â‘¡ ê°€ê²Œëª… / â‘¢ ë„ë¡œëª… ì£¼ì†Œ API / â‘£ ì „í™”ë²ˆí˜¸ -->
                <div class="row mb-3">
                  <div class="row mb-3">
                    <div class="col-md-6 position-relative">
                      <!-- ê°€ê²Œëª… -->
                      <label for="storeName" class="form-label visually-hidden">ê°€ê²Œëª…</label>
                      <input type="text" id="storeName" name="storeName" class="form-control mb-3" placeholder="ê°€ê²Œëª…"
                             required/>
                      <!-- ì „í™”ë²ˆí˜¸ -->
                      <div class="form-group mb-0">
                        <label for="phonePrefix" style="font-weight: normal;">ì „í™”ë²ˆí˜¸</label>
                        <div class="d-flex gap-2">
                          <!-- ì•ìë¦¬ ì„ íƒ -->
                          <select id="phonePrefix" name="phonePrefix" class="form-select" style="max-width: 100px;">
                            <option value="" selected>ì„ íƒ</option>
                            <option value="02">02</option>
                            <option value="031">031</option>
                            <option value="032">032</option>
                            <option value="042">042</option>
                            <option value="051">051</option>
                            <option value="053">053</option>
                            <option value="062">062</option>
                            <option value="041">041</option>
                            <option value="043">043</option>
                            <option value="054">054</option>
                            <option value="055">055</option>
                            <option value="061">061</option>
                            <option value="063">063</option>
                            <option value="044">044</option>
                            <option value="010">010</option>
                            <option value="011">011</option>
                            <!-- í•„ìš”í•œ ë²ˆí˜¸ ì¶”ê°€ -->
                          </select>

                          <!-- ë‚˜ë¨¸ì§€ ë²ˆí˜¸ ì…ë ¥ -->
                          <label for="phonePrefixInput" class="visually-hidden">ì „í™”ë²ˆí˜¸ ì§ì ‘ì…ë ¥</label>
                          <input type="text" id="phonePrefixInput" name="phonePrefixInput" class="form-control"
                                 placeholder="ì§ì ‘ì…ë ¥" style="max-width: 100px;" maxlength="4"/>

                          <label for="phoneRest" class="visually-hidden">ì „í™”ë²ˆí˜¸ ë’·ìë¦¬</label>
                          <input type="text" id="phoneRest" name="phoneRest" class="form-control"
                                 placeholder="1234-5678" maxlength="9" required/>
                        </div>
                        <!-- í•©ì¹œ ì „í™”ë²ˆí˜¸ë¥¼ form submit ì‹œ hidden í•„ë“œë¡œ ë§Œë“¤ê¸° -->
                        <input type="hidden" id="phone" name="phone"/>
                      </div>
                    </div>

                    <div class="col-md-6 position-relative">
                      <!-- ì£¼ì†Œ ì…ë ¥ ì˜ì—­ -->
                      <div class="address-group">
                        <!-- ë„ë¡œëª… ì£¼ì†Œ -->
                        <label for="address-api" class="visually-hidden">ë„ë¡œëª… ì£¼ì†Œ</label>
                        <input type="text" id="address-api" name="address" class="form-control" placeholder="ë„ë¡œëª… ì£¼ì†Œ"
                               readonly/>
                        <!-- ìš°í¸ë²ˆí˜¸ (hidden) -->
                        <input type="hidden" id="zipcode" name="zipcode"/>
                        <!-- ìƒì„¸ì£¼ì†Œ -->
                        <label for="store_detail_input" class="visually-hidden">ìƒì„¸ ì£¼ì†Œ ì…ë ¥</label>
                        <input
                          type="text"
                          id="store_detail_input"
                          name="store_detail_input"
                          class="form-control mt-2"
                          placeholder="ìƒì„¸ ì£¼ì†Œ ì…ë ¥"
                          autocomplete="off"
                          spellcheck="false"
                          inputmode="text"
                        />
                        <!-- ìˆ¨ê¹€ í•„ë“œ: ìœ„ë„, ê²½ë„, ë²•ì •ì½”ë“œ -->
                        <input type="hidden" id="storeLat" name="storeLat"/>
                        <input type="hidden" id="storeLng" name="storeLng"/>
                        <input type="hidden" id="storeLegalCode" name="storeLegalCode"/>

                        <!-- ì£¼ì†Œ ê²€ìƒ‰ ë²„íŠ¼ -->
                        <button type="button" class="btn mt-2" id="searchAddressBtn"
                                style="background-color: #f39c12; color: white; border: none;">
                          ì£¼ì†Œ ê²€ìƒ‰
                        </button>
                      </div>
                    </div>
                  </div>


                  <!-- ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ ì…ë ¥ -->
                  <div class="mb-3">
                    <label for="businessRegistrationNumber" class="form-label">ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸</label>
                    <input type="text" id="businessRegistrationNumber" name="businessRegistrationNumber"
                           class="form-control" placeholder="ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ ì…ë ¥" maxlength="10" pattern="\d{10}"
                           title="ìˆ«ì 10ìë¦¬ ì…ë ¥" required/>
                  </div>

                  <!-- â‘¤ ìš”ì¼ë³„ ì˜ì—…ì‹œê°„ -->
                  <div class="box_general padding_bottom">
                    <div class="header_box version_2">
                      <h2><i class="fa fa-clock-o"></i>ì˜ì—… ì‹œê°„</h2>
                    </div>
                    <div id="opening-schedule"></div>
                  </div>

                  <!-- â‘¥ ì§€ì—­ì¹´ë“œ, ìœ ì•„ ë™ë°˜, ì£¼ì°¨ : ë¼ë””ì˜¤ Â· ì²´í¬ë°•ìŠ¤ -->
                  <div class="mb-4">

                    <!-- ì§€ì—­ì¹´ë“œ ì‚¬ìš© ê°€ëŠ¥ -->
                    <div class="form-check">
                      <input type="checkbox" class="form-check-input" id="localCard" name="isLocalCard">
                      <label class="form-check-label" for="localCard">ì§€ì—­ì¹´ë“œ ì‚¬ìš© ê°€ëŠ¥</label>
                    </div>

                    <!-- ìœ ì•„ ë™ë°˜ ê°€ëŠ¥ -->
                    <div class="form-check">
                      <input type="checkbox" class="form-check-input" id="childAllowed" name="isChildAllowed">
                      <label class="form-check-label" for="childAllowed">ìœ ì•„ ë™ë°˜ ê°€ëŠ¥</label>
                    </div>


                    <input type="hidden" name="isLocalCard" id="isLocalCardValue">
                    <input type="hidden" name="isChildAllowed" id="isChildAllowedValue">

                    <!-- ì£¼ì°¨ -->
                    <div class="mt-3">
                      <label class="form-label me-3">ì£¼ì°¨</label>
                      <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="hasParking" id="parkingFree" value="FREE">
                        <label class="form-check-label" for="parkingFree">ë¬´ë£Œ</label>
                      </div>
                      <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="hasParking" id="parkingPaid" value="PAID">
                        <label class="form-check-label" for="parkingPaid">ìœ ë£Œ</label>
                      </div>
                      <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="hasParking" id="parkingNone"
                               value="NOT_AVAILABLE">
                        <label class="form-check-label" for="parkingNone">ë¶ˆê°€</label>
                      </div>
                    </div>

                  </div>

                  <!-- â‘¦ ì‚¬ì¥ë‹˜ í•œ ì¤„ ì†Œê°œ -->
                  <div class="owner-intro-wrapper" style="width: 100%;">
                    <label for="owner-intro" style="font-weight: bold; color: #2c3e50;">
                      ì‚¬ì¥ë‹˜ í•œ ì¤„ ì†Œê°œ
                    </label>
                    <textarea
                      id="owner-intro"
                      name="ownerComment"
                      class="form-control"
                      rows="8"
                      placeholder="ë§¤ì¥ ì†Œê°œë¥¼ ì ì–´ì£¼ì„¸ìš”.
												â€¢ ì£¼ë§/ê³µíœ´ì¼ ì˜ì—… ì—¬ë¶€
												â€¢ ìœ ë£Œ ì£¼ì°¨ì¼ ê²½ìš°, ê¼­! ì ì–´ì£¼ì„¸ìš”.(ex: 1ì‹œê°„ë‹¹ 2,000ì›)"
									maxlength="200"
                                    style="white-space: pre-line; line-height: 1.5; height: 140px;"
                    ></textarea>

							<small id="owner-intro-count" class="text-muted">0 / 200ì</small>

							<div id="owner-intro-hint"
								 style="
									margin-top: 8px;
									color: #888;
									font-size: 0.9em;
									user-select: none;
									white-space: pre-line;
									line-height: 1.3;
									transition: opacity 0.3s ease;
									opacity: 1;
								"
                            >
                    </div>
                  </div>
                </div>
              </div>
            </div>

						<!-- ë©”ë‰´ë“±ë¡ -->
            <div class="box_booking_2 style_2">
              <div class="head">
                <div class="title">
                  <h3>ë©”ë‰´ ë“±ë¡</h3>
                </div>
              </div>

              <div class="main">
                <!-- ë©”ë‰´ í•­ëª©ë“¤ì´ ì¶”ê°€ë  ì»¨í…Œì´ë„ˆ -->
                <div id="menu-items">
                  <!-- ì´ˆê¸° ë©”ë‰´ í•­ëª© í•˜ë‚˜ ì˜ˆì‹œ -->
                  <div class="menu-item row align-items-center mb-4">
                    <!-- ì´ë¯¸ì§€ ì—…ë¡œë“œ ì˜ì—­ -->
                    <div class="col-md-4">
                      <div class="menu-image-upload"
                           style="border: 2px dashed #ccc; padding: 30px 20px; text-align: center; cursor: pointer; height: 180px;">
                        <p style="margin-top: 10px;">Drop files here to upload</p>
                        <input type="file" name="menus[0].menuImageFile" class="menu-image-input"/>
                        <img class="menu-preview-image" src="" alt="ë©”ë‰´ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°"
                             style="max-width: 100%; max-height: 120px; display: none; margin-top: 10px;"/>
                      </div>
                    </div>

                    <!-- ë©”ë‰´ ì •ë³´ -->
                    <div class="col-md-8">
                      <div class="row">
                        <div class="col-md-4">
                          <label for="menuName0" class="visually-hidden">ë©”ë‰´ ì´ë¦„</label>
                          <input type="text" id="menuName0" name="menus[0].menuName" class="form-control"
                                 placeholder="ë©”ë‰´ ì´ë¦„" required/>
                        </div>

                        <div class="col-md-6 mb-2">
                          <div class="input-group">
                            <label for="price0" class="visually-hidden">ê°€ê²©</label>
                            <input type="number" id="price0" name="menus[0].price" class="form-control" placeholder="ê°€ê²©"
                                   min="0" step="100" required/>
                            <span class="input-group-text">ì›</span>
                          </div>
                        </div>

                        <div class="col-md-8 mb-2 d-flex gap-2">
                          <label for="ramenCategoryId0" class="visually-hidden">ì¹´í…Œê³ ë¦¬ ì„ íƒ</label>
                          <select id="ramenCategoryId0" name="menus[0].ramenCategoryId"
                                  class="form-select form-select-sm scrollable-select" style="flex: 1;">
                            <option value="" disabled selected>ì¹´í…Œê³ ë¦¬ ì„ íƒ</option>
                            <!-- ì¹´í…Œê³ ë¦¬ ì˜µì…˜ë“¤ -->
                          </select>
                          <label for="ramenSoupId0" class="visually-hidden">ìœ¡ìˆ˜ ì„ íƒ</label>
                          <select id="ramenSoupId0" name="menus[0].ramenSoupId"
                                  class="form-select form-select-sm scrollable-select" style="flex: 1;">
                            <option value="" disabled selected>ìœ¡ìˆ˜ ì„ íƒ</option>
                            <!-- ìœ¡ìˆ˜ ì˜µì…˜ë“¤ -->
                          </select>
                        </div>

                        <div class="col-md-12 mb-2 d-flex gap-3 align-items-start">
                          <div class="col-md-6 mt-2">
                            <label for="menuDescription0" class="visually-hidden">ë©”ë‰´ ì„¤ëª…</label>
                              <textarea
                                      id="menuDescription0"
                                      name="menus[0].menuDescription"
                                      class="form-control"
                                      rows="2"
                                      placeholder="ì„¤ëª…"
                                      maxlength="100"
                              ></textarea>
                              <small id="menuDescription-count-0" class="text-muted">0 / 100ì</small>
                          </div>
                          <div>
                            <label class="form-label d-block">ê¸°ë³¸ í† í•‘ ì„ íƒ</label>
                            <div class="topping-tags" data-menu-index="0"></div>
                            <div class="default-toppings-container"></div>
                          </div>
                        </div>
                        <div class="text-end mt-2">
                          <button type="button" class="btn btn-sm btn-outline-danger remove-menu">ë©”ë‰´ ì‚­ì œ</button>
                        </div>
                        <div id="extra-toppings-container-0" style="display:none;"></div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- ë©”ë‰´ ì¶”ê°€ ë²„íŠ¼ -->
                <div class="text-start mb-3">
                  <button type="button" id="add-menu" class="btn btn-sm btn-outline-primary">+ ë©”ë‰´ ì¶”ê°€</button>
                </div>

              </div>
              <div class="main">

                <div class="topping-item row align-items-center mb-4">

                  <!-- í† í•‘ ì„ íƒ ì˜ì—­ -->
                  <div class="d-flex gap-2 align-items-center mb-2">
                    <label for="topping-select" class="form-label mb-0">í† í•‘ ì„ íƒ</label>
                    <select id="topping-select" class="form-select" style="width: 200px;">
                      <option value="">-- í† í•‘ ì„ íƒ --</option>
                      <th:block th:each="topping : ${toppings}">
                        <option th:value="${topping.id}" th:text="${topping.name}"></option>
                      </th:block>
                    </select>
                    <input type="number" id="topping-price" class="form-control" placeholder="ê°€ê²© (ì›)" style="width: 120px;" min="0" step="100"/>
                    <button type="button" class="btn btn-sm btn-outline-primary add-topping-btn">+ í† í•‘ ì¶”ê°€</button>
                  </div>

                  <!-- ì—¬ê¸°ì— ì¶”ê°€ëœ í† í•‘ë“¤ì´ ë Œë”ë§ë¨ -->
                  <div id="store-extra-toppings-container" class="d-flex flex-column gap-2 mt-2"></div>
                </div>

              </div>

                <!-- ë“±ë¡ ë²„íŠ¼ -->
              <div class="text-center">
                <button type="submit" class="btn btn-success btn-lg">ë“±ë¡í•˜ê¸°</button>
              </div>
            </div>
          </form>


        </div>
      </div>
    </div>
  </main>
  <!--/footer-->
	<footer th:replace="~{fragments/footer :: footer}"></footer>

  <!-- â—JS ìŠ¤í¬ë¦½íŠ¸ â— -->


  <!-- COMMON SCRIPTS -->
  <script src="/js/common_scripts.min.js"></script>
  <script src="/js/common_func.js"></script>
  <script src="/assets/validate.js"></script>

  <!-- ì¹´ì¹´ì˜¤ ë‹¤ìŒ ìš°í¸ë²ˆí˜¸ API ìŠ¤í¬ë¦½íŠ¸ -->
  <script src="https://ssl.daumcdn.net/dmaps/map_js_init/postcode.v2.js" charset="utf-8"></script>
  <script type="text/javascript"
          src="//dapi.kakao.com/v2/maps/sdk.js?appkey=d8455fa8f84607ce70b0cd1184c74538&libraries=services"></script>

  <script>
    /* ========== ì£¼ì†Œ ê²€ìƒ‰ (ì¹´ì¹´ì˜¤) ========== */
    function openPostcode() {
      new daum.Postcode({
        oncomplete: function (data) {
          const roadAddress = data.roadAddress;
          const zonecode = data.zonecode;

          document.getElementById("address-api").value = roadAddress;
          document.getElementById("zipcode").value = zonecode;
          document.getElementById("store_detail_input").focus();

          fetch("/location/info", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            credentials: 'include',
            body: JSON.stringify({roadAddress})
          })
            .then(res => {
              return res.json();
            })
            .then(data => {
              document.getElementById("storeLat").value = data.storeLat || '';
              document.getElementById("storeLng").value = data.storeLng || '';
              document.getElementById("storeLegalCode").value = data.storeLegalCode || '';
            })
            .catch(err => console.error("ì£¼ì†Œ ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨:", err));
        }
      }).open();
    }

    document.getElementById("searchAddressBtn").addEventListener("click", openPostcode);
    document.getElementById("address-api").addEventListener("click", openPostcode);


    /* ========== ì „í™”ë²ˆí˜¸ ì…ë ¥ ì²˜ë¦¬ ========== */
    const phonePrefix = document.getElementById('phonePrefix');
    const phonePrefixInput = document.getElementById('phonePrefixInput');
    const phoneRest = document.getElementById('phoneRest');
    const phoneHidden = document.getElementById('phone');

    // ì „í™”ë²ˆí˜¸ ì…ë ¥ í•„ë“œ í™œì„±/ë¹„í™œì„± í† ê¸€ í•¨ìˆ˜
    function togglePrefixInputs() {
      if (phonePrefix.value && phonePrefix.value !== "") {
        phonePrefixInput.value = '';
        phonePrefixInput.disabled = true;
        phonePrefix.disabled = false;
      } else if (phonePrefixInput.value.trim() !== '') {
        phonePrefix.value = '';
        phonePrefix.disabled = true;
        phonePrefixInput.disabled = false;
      } else {
        phonePrefix.disabled = false;
        phonePrefixInput.disabled = false;
      }
    }

    phonePrefix.addEventListener('change', togglePrefixInputs);
    phonePrefixInput.addEventListener('input', togglePrefixInputs);

    togglePrefixInputs();

    // ìë™ í•˜ì´í”ˆ í•¨ìˆ˜
    phoneRest.addEventListener('input', function (e) {
      const input = e.target;
      let numbers = input.value.replace(/\D/g, '');

      if (numbers.length <= 3) {
        input.value = numbers;
      } else if (numbers.length <= 7) {
        input.value = numbers.replace(/(\d{3})(\d+)/, '$1-$2');
      } else {
        input.value = numbers.replace(/(\d{4})(\d{4})/, '$1-$2');
      }
    });

    function isMenuNameDuplicated() {
      const nameInputs = Array.from(document.querySelectorAll('input[name$=".menuName"]'));
      const names = nameInputs.map(input => input.value.trim()).filter(Boolean);

      const nameCount = {};
      for (let name of names) {
        if (!nameCount[name]) nameCount[name] = 1;
        else nameCount[name]++;
      }

      const duplicates = Object.entries(nameCount).filter(([name, count]) => count > 1);
      if (duplicates.length > 0) {
        alert(`ë©”ë‰´ ì´ë¦„ "${duplicates[0][0]}" ì´(ê°€) ì¤‘ë³µë©ë‹ˆë‹¤. ë‹¤ë¥¸ ì´ë¦„ìœ¼ë¡œ ë°”ê¿”ì£¼ì„¸ìš”.`);
        return true;
      }
      return false;
    }

    // SUBMIT ì—¬ê¸°ê°€ ì œì¶œ ë²„íŠ¼ì„!!

    document.addEventListener("DOMContentLoaded", function () {
      const form = document.getElementById("register");

      form.addEventListener("submit", async function (e) {
        e.preventDefault(); // ê¸°ë³¸ ì œì¶œ ë§‰ê¸°

        const formData = new FormData();

        // 1. ëŒ€í‘œ ì´ë¯¸ì§€
        const imageInput = document.getElementById("image-input");
        if (imageInput && imageInput.files.length > 0) {
          formData.append("storeMainImage", imageInput.files[0]);
        }

        // 2. ë©”ë‰´ ì´ë¯¸ì§€ë“¤
        document.querySelectorAll('.menu-item').forEach((item, idx) => {
          const menuImgInput = item.querySelector('.menu-image-input');
          if (menuImgInput && menuImgInput.files.length > 0) {
            formData.append(`menus[${idx}].menuImageFile`, menuImgInput.files[0]);
          }
        });

        // 3. ë‚˜ë¨¸ì§€ ì…ë ¥ê°’ (storeData ê°ì²´)
        const storeData = {};

        storeData.storeName = document.getElementById("storeName").value;
        storeData.phone = document.getElementById("phone").value;
        storeData.address = document.getElementById("address-api").value;
        storeData.zipcode = document.getElementById("zipcode").value;
        storeData.storeDetailInput = document.getElementById("store_detail_input").value;
        storeData.storeLat = document.getElementById("storeLat").value;
        storeData.storeLng = document.getElementById("storeLng").value;
        storeData.storeLegalCode = document.getElementById("storeLegalCode").value;
        storeData.businessRegistrationNumber = document.getElementById("businessRegistrationNumber").value;
        storeData.ownerComment = document.getElementById("owner-intro").value;

        // isLocalCard / isChildAllowed / parking
        storeData.isLocalCard = document.getElementById("localCard").checked;
        storeData.isChildAllowed = document.getElementById("childAllowed").checked;
        storeData.hasParking = document.querySelector('input[name="hasParking"]:checked')?.value;

        // 4. ì˜ì—…ì‹œê°„ (ìš”ì¼ë³„ ìŠ¤ì¼€ì¤„)
        storeData.weekSchedule = [];
        for (let i = 0; i < 7; i++) {
          storeData.weekSchedule.push({
            dayOfWeek: document.querySelector(`[name="weekSchedule[${i}].dayOfWeek"]`).value,
            openingAt: document.querySelector(`[name="weekSchedule[${i}].openingAt"]`).value,
            closingAt: document.querySelector(`[name="weekSchedule[${i}].closingAt"]`).value,
            isClosedDay: document.getElementById(`closed-day-${i}`).value === "true"
          });
        }

        // 5. ë©”ë‰´ ë¦¬ìŠ¤íŠ¸
        storeData.menus = [];
        document.querySelectorAll('.menu-item').forEach((menu, idx) => {
          const menuDto = {
            menuName: menu.querySelector(`[name="menus[${idx}].menuName"]`).value,
            price: menu.querySelector(`[name="menus[${idx}].price"]`).value,
            menuDescription: menu.querySelector(`[name="menus[${idx}].menuDescription"]`).value,
            ramenCategoryId: menu.querySelector(`[name="menus[${idx}].ramenCategoryId"]`).value,
            ramenSoupId: menu.querySelector(`[name="menus[${idx}].ramenSoupId"]`).value,
            defaultToppingIds: Array.from(
                    menu.querySelectorAll(`input[name="menus[${idx}].defaultToppingIds"]`)
            ).map(input => input.value)
          };

          storeData.menus.push(menuDto);
        });

        // 6. ì¶”ê°€ í† í•‘ ìˆ˜ì§‘
        storeData.extraToppings = [];
        document.querySelectorAll(".store-topping-btn.btn-success").forEach(btn => {
          const toppingId = parseInt(btn.dataset.id);
          const priceInput = document.querySelector(`.topping-price-input[data-id="${toppingId}"]`);
          const price = parseInt(priceInput?.value || '0', 10);

          if (!isNaN(toppingId)) {
            storeData.extraToppings.push({
              toppingId: toppingId,
              price: price
            });
          }
        });

        console.log("ë³´ë‚¼ storeData:", storeData); // í™•ì¸ìš©

        // 7. JSONì„ Blobìœ¼ë¡œ FormDataì— ë‹´ê¸°
        const dtoBlob = new Blob([JSON.stringify(storeData)], {
          type: "application/json;charset=utf-8"
        });
        formData.append("dto", dtoBlob);

        // 8. ì„œë²„ë¡œ ì „ì†¡
        try {
          const response = await fetch("/store/regist", {
            method: "POST",
            body: formData,
          });

          if (response.ok) {
            const data = await response.json();
            alert("ë“±ë¡ ì„±ê³µ!");
            window.location.href = `/store/detail/${data.storeId}`;
          } else {
            const errorData = await response.json();
            alert("ë“±ë¡ ì‹¤íŒ¨: " + (errorData?.message || `ì„œë²„ ì˜¤ë¥˜ (${response.status})`));
            console.error("ì„œë²„ ì‘ë‹µ:", errorData);
          }
        } catch (err) {
          console.error("ë“±ë¡ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", err);
          alert("ì„œë²„ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      });
    });

    /* ========== ëŒ€í‘œ ì´ë¯¸ì§€ ì—…ë¡œë“œ ë¯¸ë¦¬ë³´ê¸° ========== */

    // ëŒ€í‘œ ì´ë¯¸ì§€ ì„ íƒ ì‹œ ë¯¸ë¦¬ë³´ê¸° ë„ìš°ê¸°
    document.getElementById('image-input').addEventListener('change', (event) => {
      const file = event.target.files[0];
      if (file) {
        const preview = document.getElementById('preview-image');
        const uploadText = document.getElementById('upload-text');
        const reader = new FileReader();
        reader.onload = (e) => {
          preview.src = e.target.result;
          preview.style.display = 'block';
          uploadText.style.display = 'none';
        };
        reader.readAsDataURL(file);
      }
    });

    let menuIndex = 1;
    const menuList = document.getElementById('menu-items');
    const template = document.querySelector('.menu-item');
    const addButton = document.getElementById('add-menu');

    /* ========== ì˜ì—…ì‹œê°„ closed ========== */

    document.querySelectorAll('select[name^="weekSchedule"]').forEach(select => {
      select.addEventListener('change', e => {
        const name = e.target.name;
        const match = name.match(/\[(\d+)\]/);
        if (match) {
          const idx = Number(match[1]);
          checkClosed(idx);
        }
      });
    });

		/* ========== ë©”ë‰´ ì¶”ê°€ ë²„íŠ¼ í´ë¦­ ì‹œ ========== */

    addButton.addEventListener('click', () => {
      const clone = template.cloneNode(true);

      // ë©”ë‰´ í¼ ì´ˆê¸°í™”
      clone.querySelectorAll('input, textarea').forEach(input => {
        if (input.type === 'file') {
          input.value = null;
        } else {
          input.value = '';
        }
      });

      clone.querySelectorAll('select').forEach(select => {
        select.selectedIndex = 0;
      });

      // ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° ì´ˆê¸°í™”
      const preview = clone.querySelector('.menu-preview-image');
      const uploadText = clone.querySelector('.menu-image-upload p');
      if (preview && uploadText) {
        preview.src = '';
        preview.style.display = 'none';
        uploadText.style.display = 'block';
      }

      // í† í•‘ ì´ˆê¸°í™”
      clone.querySelectorAll('.topping-tag.selected').forEach(tag => tag.classList.remove('selected'));
      const toppingContainer = clone.querySelector('.default-toppings-container');
      if (toppingContainer) toppingContainer.innerHTML = '';

      menuList.appendChild(clone);

      // ì¸ë±ìŠ¤ ì¬ì •ë ¬ & ê°ì¢… ì´ë²¤íŠ¸ ì¬ì„¤ì •
      updateMenuIndices();
      setupToppingTags();
      setupExtraToppingButtons();
      setupMenuImageUpload(clone);
    });

    /* ========== ë©”ë‰´ ì‚­ì œ ë²„íŠ¼ í´ë¦­ ì‹œ ========== */

    function updateMenuIndices() {
      const menuItems = document.querySelectorAll('.menu-item');
      menuItems.forEach((item, idx) => {
        item.querySelectorAll('input, textarea, select').forEach(el => {
          if (el.name) {
            el.name = el.name.replace(/\d+/, idx);
          }
          if (el.id) {
            el.id = el.id.replace(/\d+/, idx);
          }
        });

        // í† í•‘ ê´€ë ¨ ì¸ë±ìŠ¤ë„ ì¬ì§€ì •
        const toppingTags = item.querySelector('.topping-tags');
        if (toppingTags) {
          toppingTags.dataset.menuIndex = idx;
        }

        const toppingInputs = item.querySelectorAll('input[name^="menus["][name$=".defaultToppingIds"]');
        toppingInputs.forEach(input => {
          input.name = `menus[${idx}].defaultToppingIds`;
        });
      });
    }

    // ë©”ë‰´ ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸ ìœ„ì„ ë°©ì‹
    document.getElementById('menu-items').addEventListener('click', function (e) {
      if (e.target.classList.contains('remove-menu')) {
        const allMenus = document.querySelectorAll('.menu-item');
        if (allMenus.length > 1) {
          e.target.closest('.menu-item').remove();
          updateMenuIndices();
          setupToppingTags();
          setupExtraToppingButtons();
          setupMenuImageUpload(document);
        } else {
          alert("ìµœì†Œ í•œ ê°œì˜ ë©”ë‰´ëŠ” ë“±ë¡ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.");
        }
      }
    });

    /* ========== ê¸°ë³¸ í† í•‘ ì„ íƒ ê¸°ëŠ¥ ========== */
    function setupToppingTags(context = document) {
      const target = context === document ? document : context;
      target.querySelectorAll('.topping-tag').forEach(tag => {
        tag.onclick = () => {
          tag.classList.toggle('selected');

          const menuItem = tag.closest('.menu-item');
          const menuIndex = menuItem.querySelector('.topping-tags').dataset.menuIndex;
          const toppingId = tag.dataset.id;
          const defaultContainer = menuItem.querySelector('.default-toppings-container');

          const existing = defaultContainer.querySelector(`input[value="${toppingId}"]`);

          if (tag.classList.contains('selected')) {
            if (!existing) {
              const input = document.createElement('input');
              input.type = 'hidden';
              input.name = `menus[${menuIndex}].defaultToppingIds`;
              input.value = toppingId;
              defaultContainer.appendChild(input);
            }
          } else {
            if (existing) defaultContainer.removeChild(existing);
          }
        };
      });
    }

    /* ========== ë©”ë‰´ ì´ë¯¸ì§€ ì—…ë¡œë“œ ê¸°ëŠ¥ ========== */
    function setupMenuImageUpload(area) {
      const uploadArea = area.querySelector('.menu-image-upload');
      if (uploadArea.dataset.listenerAdded) {
        return;
      }
      uploadArea.dataset.listenerAdded = 'true';

      const input = uploadArea.querySelector('.menu-image-input');
      input.setAttribute("accept", "image/*");
      const preview = uploadArea.querySelector('.menu-preview-image');
      const uploadText = uploadArea.querySelector('p');

      // íŒŒì¼ input ìˆ¨ê¸°ê¸°
      input.style.display = 'none';

      uploadArea.addEventListener('click', () => input.click());

      ['dragover', 'dragleave'].forEach(evt =>
        uploadArea.addEventListener(evt, e => {
          e.preventDefault();
          uploadArea.style.borderColor = evt === 'dragover' ? '#007bff' : '#ccc';
        })
      );

      uploadArea.addEventListener('drop', e => {
        e.preventDefault();
        uploadArea.style.borderColor = '#ccc';
        const file = e.dataTransfer.files[0];
        if (file) {
          input.files = e.dataTransfer.files;
          preview.src = URL.createObjectURL(file);
          preview.style.display = 'block';
          uploadText.style.display = 'none';
        }
      });

      input.addEventListener('change', () => {
        const file = input.files[0];
        if (file) {
          preview.src = URL.createObjectURL(file);
          preview.style.display = 'block';
          uploadText.style.display = 'none';
        } else {
          // íŒŒì¼ ì·¨ì†Œ ì‹œ ë¯¸ë¦¬ë³´ê¸°ì™€ í…ìŠ¤íŠ¸ ë³µì›
          preview.style.display = 'none';
          uploadText.style.display = 'block';
        }
      });
    }

    /* ========== í•œ ì¤„ ì†Œê°œ ========== */
    const textarea = document.getElementById('owner-intro');
    const wrapper = textarea.closest('.owner-intro-wrapper');

    function toggleHint() {
      if (textarea.value.trim().length > 0) {
        wrapper.classList.add('text-filled');
      } else {
        wrapper.classList.remove('text-filled');
      }
    }

    textarea.addEventListener('input', toggleHint);
    window.addEventListener('DOMContentLoaded', toggleHint);

    /* ========== ìš”ì¼ë³„ ì˜ì—…ì‹œê°„ ========== */
    const days = ["MONDAY", "TUESDAY", "WEDNESDAY", "THURSDAY", "FRIDAY", "SATURDAY", "SUNDAY"];
    const dayLabels = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];

    function generateTimeOptions() {
      const options = [];
      for (let h = 0; h < 24; h++) {
        const hour = h % 12 === 0 ? 12 : h % 12;
        const meridian = h < 12 ? "AM" : "PM";
        const value = `${h.toString().padStart(2, '0')}:00`;
        const label = `${hour} ${meridian}`;
        options.push(`<option value="${value}">${label}</option>`);
      }
      return options.join("");
    }

    function checkClosed(event, index) {
      const open = document.querySelector(`[name="weekSchedule[${index}].openingAt"]`);
      const close = document.querySelector(`[name="weekSchedule[${index}].closingAt"]`);
      const closedInput = document.getElementById(`closed-day-${index}`);

      if (event.target.value === "CLOSED") {
        open.dataset.prevValue = open.value;
        close.dataset.prevValue = close.value;

        open.value = "CLOSED";
        close.value = "CLOSED";
        closedInput.value = "true";
      } else {
        closedInput.value = "false";

        if (event.target === open) {
          if (close.value === "CLOSED" && close.dataset.prevValue) {
            close.value = close.dataset.prevValue;
          }
        } else if (event.target === close) {
          if (open.value === "CLOSED" && open.dataset.prevValue) {
            open.value = open.dataset.prevValue;
          }
        }
      }
    }

    function renderOpeningSchedule() {
      const container = document.getElementById("opening-schedule");
      let html = "";
      for (let i = 0; i < days.length; i++) {
        html += `
		<div class="row mb-2 align-items-center">
			<div class="col-md-2">
				<label class="fix_spacing">${dayLabels[i]}</label>
				<input type="hidden" name="weekSchedule[${i}].dayOfWeek" value="${days[i]}">
				<input type="hidden" name="weekSchedule[${i}].isClosedDay" value="false" id="closed-day-${i}">
			</div>
			<div class="col-md-5">
				<select class="form-control"
						name="weekSchedule[${i}].openingAt"
						onchange="checkClosed(event, ${i})"
						data-prev-value="">
					<option value="">Opening Time</option>
					<option value="CLOSED">Closed</option>
					${generateTimeOptions()}
				</select>
			</div>
			<div class="col-md-5">
				<select class="form-control"
						name="weekSchedule[${i}].closingAt"
						onchange="checkClosed(event, ${i})"
						data-prev-value="">
					<option value="">Closing Time</option>
					<option value="CLOSED">Closed</option>
					${generateTimeOptions()}
				</select>
			</div>
		</div>`;
      }
      container.innerHTML = html;
    }
  </script>

  <script>
    document.addEventListener("DOMContentLoaded", async function () {
      // renderOpeningSchedule
      renderOpeningSchedule();

      // â‘  ë©”ë‰´ ì„¤ëª… ê¸€ì ìˆ˜ - ìµœì´ˆ 1ê°œ
      const firstDesc = document.getElementById("menuDescription0");
      const firstCounter = document.getElementById("menuDescription-count-0");
      if (firstDesc && firstCounter) {
        updateMenuDescriptionCharCount(firstDesc, "menuDescription-count-0");
      }

      // â‘¡ ë©”ë‰´ ì¶”ê°€ ì‹œ ì„¤ëª… ê¸€ì ìˆ˜ ì¶”ê°€
      const addMenuBtn = document.getElementById("add-menu");
      if (addMenuBtn) {
        addMenuBtn.addEventListener("click", () => {
          setTimeout(() => {
            const menuItems = document.querySelectorAll(".menu-item");
            const lastIndex = menuItems.length - 1;
            const newTextarea = document.getElementById(`menuDescription${lastIndex}`);
            const counterId = `menuDescription-count-${lastIndex}`;

            if (newTextarea && !document.getElementById(counterId)) {
              const counter = document.createElement("small");
              counter.id = counterId;
              counter.className = "text-muted";
              counter.textContent = "0 / 100ì";
              newTextarea.insertAdjacentElement("afterend", counter);

              updateMenuDescriptionCharCount(newTextarea, counterId);
            }

            setupToppingAddButton(); // ìƒˆ í† í•‘ ì¶”ê°€ ë²„íŠ¼ì—ë„ ì´ë²¤íŠ¸ ë‹¤ì‹œ ì—°ê²°
          }, 100);
        });
      }

      // â‘¢ ì‚¬ì¥ë‹˜ í•œ ì¤„ ì†Œê°œ ê¸€ì ìˆ˜
      const introTextarea = document.getElementById("owner-intro");
      const countDisplay = document.getElementById("owner-intro-count");
      if (introTextarea && countDisplay) {
        const updateIntroCount = () => {
          countDisplay.textContent = `${introTextarea.value.length} / 200ì`;
        };
        introTextarea.addEventListener("input", updateIntroCount);
        updateIntroCount();
      }

      // â‘£ ë©”ë‰´ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°
      document.querySelectorAll('.menu-image-input').forEach(input => {
        input.addEventListener('change', e => {
          const file = e.target.files[0];
          if (file) {
            const uploadArea = input.closest('.menu-image-upload');
            const menuPreview = uploadArea.querySelector('.menu-preview-image');
            const uploadText = uploadArea.querySelector('p');

            menuPreview.src = URL.createObjectURL(file);
            menuPreview.style.display = 'block';
            uploadText.style.display = 'none';
          }
        });
      });

      // â‘¤ í† í•‘ ì¶”ê°€ ë²„íŠ¼ ì´ë²¤íŠ¸ ì—°ê²° (ìµœì´ˆ 1íšŒ)
      setupToppingAddButton();

      // â‘¥ ë©”ë‰´ ê´€ë ¨ ì´ˆê¸°í™” í•¨ìˆ˜ë“¤
      setupToppingTags();
      setupExtraToppingButtons();
      setupMenuImageUpload(document);

      // â‘¦ ì„œë²„ì—ì„œ ì¹´í…Œê³ ë¦¬, ìœ¡ìˆ˜, í† í•‘ ê°€ì ¸ì˜¤ê¸°
      try {
        const [toppingsRes, categoriesRes, soupsRes] = await Promise.all([
          fetch('/ramen/toppings'),
          fetch('/ramen/categories'),
          fetch('/ramen/soups')
        ]);
        const toppings = await toppingsRes.json();
        const categories = await categoriesRes.json();
        const soups = await soupsRes.json();

        renderAllMenus(categories, soups, toppings);
        addExtraTopping(0); // ë©”ë‰´ ì¸ë±ìŠ¤ 0ìœ¼ë¡œ ì´ˆê¸° ë Œë”
        setupToppingTagEvents();
      } catch (error) {
        console.error("ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", error);
      }

      // â‘§ extra í† í•‘ ì„ íƒ ì‹œ ê°€ê²© ì…ë ¥ ë° form hidden ì¶”ê°€
      document.querySelectorAll('.store-topping-btn').forEach(btn => {
        btn.addEventListener("click", function () {
          const id = btn.dataset.id;
          btn.classList.toggle("btn-success");
          btn.classList.toggle("btn-outline-secondary");

          const priceInput = document.querySelector(`.topping-price-input[data-id="${id}"]`);
          if (!priceInput) return;

          if (btn.classList.contains("btn-success")) {
            priceInput.style.display = "block";
            priceInput.required = true;
          } else {
            priceInput.style.display = "none";
            priceInput.value = "";
            priceInput.required = false;
          }
        });
      });

      // â‘¨ submit ì‹œ ì„ íƒëœ í† í•‘ë“¤ formì— ì¶”ê°€
      document.getElementById("register").addEventListener("submit", function () {
        const form = this;
        const selected = document.querySelectorAll(".store-topping-btn.btn-success");

        selected.forEach((btn, idx) => {
          const toppingId = btn.dataset.id;
          const priceInput = document.querySelector(`.topping-price-input[data-id="${toppingId}"]`);
          const price = priceInput ? priceInput.value : "";

          const idInput = document.createElement("input");
          idInput.type = "hidden";
          idInput.name = `extraToppings[${idx}].toppingId`;
          idInput.value = toppingId;

          const priceHidden = document.createElement("input");
          priceHidden.type = "hidden";
          priceHidden.name = `extraToppings[${idx}].price`;
          priceHidden.value = price;

          form.appendChild(idInput);
          form.appendChild(priceHidden);
        });
      });
    });

    // ------------------------
    // ğŸ”§ í•¨ìˆ˜ë“¤ (DOM ë°–ìœ¼ë¡œ ë¹¼ë†“ì€ ë¶€ë¶„)
    // ------------------------

    function updateMenuDescriptionCharCount(textarea, counterId) {
      const counter = document.getElementById(counterId);
      if (!textarea || !counter) return;

      counter.textContent = `${textarea.value.length} / 100ì`;

      textarea.addEventListener('input', () => {
        counter.textContent = `${textarea.value.length} / 100ì`;
      });
    }

    // âœ… í† í•‘ ì¶”ê°€ ë²„íŠ¼ ì´ë²¤íŠ¸ ì—°ê²° í•¨ìˆ˜
    function setupToppingAddButton() {
      const container = document.getElementById("store-extra-toppings-container");
      const addButtons = document.querySelectorAll(".add-topping-btn");

      addButtons.forEach(button => {
        const newButton = button.cloneNode(true);
        button.replaceWith(newButton);

        newButton.addEventListener("click", function () {
          const select = document.getElementById("topping-select");
          const priceInput = document.getElementById("topping-price");

          if (!select || !priceInput) {
            alert("í† í•‘ ì„ íƒ ì˜ì—­ì´ ì—†ìŠµë‹ˆë‹¤.");
            return;
          }

          const toppingId = select.value;
          const toppingName = select.options[select.selectedIndex].text;
          const price = priceInput.value;

          if (!toppingId || !price) {
            alert("í† í•‘ê³¼ ê°€ê²©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return;
          }

          const exists = container.querySelector(`input[name="extraToppings[].toppingId"][value="${toppingId}"]`);
          if (exists) {
            alert("ì´ë¯¸ ì¶”ê°€ëœ í† í•‘ì…ë‹ˆë‹¤.");
            return;
          }

          const div = document.createElement("div");
          div.className = "d-flex align-items-center gap-3";
          div.innerHTML = `
          <span>${toppingName} (${price}ì›)</span>
          <input type="hidden" name="extraToppings[].toppingId" value="${toppingId}"/>
          <input type="hidden" name="extraToppings[].price" value="${price}"/>
          <button type="button" class="btn btn-sm btn-outline-danger remove-topping">ì‚­ì œ</button>
        `;

          div.querySelector(".remove-topping").addEventListener("click", () => {
            div.remove();
          });

          container.appendChild(div);
          priceInput.value = "";
        });
      });
    }
  </script>

  <script>
    // ì¹´í…Œê³ ë¦¬, ìœ¡ìˆ˜, í† í•‘ ê´€ë ¨
    document.addEventListener('DOMContentLoaded', async () => {
      try {
        const [toppingsRes, categoriesRes, soupsRes] = await Promise.all([
          fetch('/ramen/toppings'),
          fetch('/ramen/categories'),
          fetch('/ramen/soups')
        ]);

        const toppings = await toppingsRes.json();
        const categories = await categoriesRes.json();
        const soups = await soupsRes.json();

        renderAllMenus(categories, soups, toppings);
        addExtraTopping(menuIndex);
        setupToppingTagEvents();

      } catch (error) {
        console.error("ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", error);
      }
    });

    function setupExtraToppingButtons(context = document) {
      context.querySelectorAll('.add-extra-topping').forEach(button => {
        button.onclick = () => {
          const menuItem = button.closest('.menu-item');
          const menus = Array.from(document.querySelectorAll('.menu-item'));
          const menuIndex = menus.indexOf(menuItem);
          addExtraTopping(menuIndex);
        };
      });
    }

    function addExtraTopping(menuIndex) {
      const menuItems = document.querySelectorAll('.menu-item');
      const menuItem = menuItems[menuIndex];
      if (!menuItem) return;

      const container = menuItem.querySelector('.extra-topping-container');
      if (!container) return;

      const inputWrapper = document.createElement('div');
      inputWrapper.className = 'input-group mb-2';

      const input = document.createElement('input');
      input.type = 'text';
      input.className = 'form-control';
      input.name = `menus[${menuIndex}].extraToppings[]`;
      input.placeholder = 'ì¶”ê°€ í† í•‘ ì…ë ¥';

      const removeBtn = document.createElement('button');
      removeBtn.type = 'button';
      removeBtn.className = 'btn btn-outline-danger';
      removeBtn.textContent = 'ì‚­ì œ';
      removeBtn.onclick = () => inputWrapper.remove();

      inputWrapper.appendChild(input);
      inputWrapper.appendChild(removeBtn);
      container.appendChild(inputWrapper);
    }


    // ì—¬ëŸ¬ ë©”ë‰´ì— ì˜µì…˜/í† í•‘ ë Œë”ë§
    function renderAllMenus(categories, soups, toppings) {
      document.querySelectorAll('.menu-item').forEach((menuEl, idx) => {
        renderCategoryOptions(categories, menuEl.querySelector('select[name$=".ramenCategoryId"]'));
        renderSoupOptions(soups, menuEl.querySelector('select[name$=".ramenSoupId"]'));
        renderToppingTags(toppings, menuEl.querySelector('.topping-tags'), idx);
      });
    }

    function renderCategoryOptions(categories, selectEl) {
      if (!selectEl) return;
      selectEl.innerHTML = '<option value="" disabled selected>ì¹´í…Œê³ ë¦¬ ì„ íƒ</option>';
      categories.forEach(cat => {
        const option = document.createElement('option');
        option.value = cat.id;
        option.textContent = cat.categoryName || cat.name;
        selectEl.appendChild(option);
      });
    }

    function renderSoupOptions(soups, selectEl) {
      if (!selectEl) return;
      selectEl.innerHTML = '<option value="" disabled selected>ìœ¡ìˆ˜ ì„ íƒ</option>';
      soups.forEach(soup => {
        const option = document.createElement('option');
        option.value = soup.id;
        option.textContent = soup.soupName;
        selectEl.appendChild(option);
      });
    }

    function renderToppingTags(toppings, container, menuIndex) {
      if (!container) return;
      container.innerHTML = '';
      container.dataset.menuIndex = menuIndex;
      toppings.forEach(top => {
        const span = document.createElement('span');
        span.className = 'topping-tag';
        span.dataset.id = top.id;
        span.textContent = top.name;
        container.appendChild(span);
      });
      setupToppingTagEvents(container);
    }

    function setupToppingTagEvents(container) {
      const containers = container ? [container] : document.querySelectorAll('.topping-tags');
      containers.forEach(cont => {
        cont.querySelectorAll('.topping-tag').forEach(tag => {
          tag.onclick = () => tag.classList.toggle('selected');
        });
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      setupToppingTags();
      setupExtraToppingButtons();
      setupMenuImageUpload(document);

      const addStoreExtraToppingBtn = document.getElementById('add-store-extra-topping');
      if (addStoreExtraToppingBtn) {
        addStoreExtraToppingBtn.addEventListener('click', addStoreExtraTopping);
      }

      const imageInputs = document.querySelectorAll('.menu-image-input');
      imageInputs.forEach(input => {
        input.addEventListener('change', (event) => {
          const file = event.target.files[0];
          if (file) {
            const uploadArea = input.closest('.menu-image-upload');
            const menuPreview = uploadArea.querySelector('.menu-preview-image');
            const uploadText = uploadArea.querySelector('p');

            menuPreview.src = URL.createObjectURL(file);
            menuPreview.style.display = 'block';
            uploadText.style.display = 'none';
          }
        });
      });
    });
  </script>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // í† í•‘ ë²„íŠ¼ í´ë¦­ â†’ price ì…ë ¥ í‘œì‹œ toggle
      document.querySelectorAll(".store-topping-btn").forEach(function (btn) {
        btn.addEventListener("click", function () {
          const id = btn.dataset.id;
          btn.classList.toggle("btn-success");
          btn.classList.toggle("btn-outline-secondary");

          const priceInput = document.querySelector(`.topping-price-input[data-id="${id}"]`);
          if (btn.classList.contains("btn-success")) {
            priceInput.style.display = "block";
            priceInput.required = true;
          } else {
            priceInput.style.display = "none";
            priceInput.value = "";
            priceInput.required = false;
          }
        });
      });

      // submit ì‹œ ì„ íƒëœ extra í† í•‘ + ê°€ê²© -> formì— hidden inputìœ¼ë¡œ ì£¼ì…
      document.getElementById("register").addEventListener("submit", function (e) {
        const form = this;

        // ê¸°ì¡´ì— ì¶”ê°€ëœ hidden input ì œê±° (ì¤‘ë³µ ë°©ì§€)
        form.querySelectorAll('input[name^="extraToppings"]').forEach(input => input.remove());

        const selected = document.querySelectorAll(".store-topping-btn.btn-success");

        selected.forEach((btn, idx) => {
          const toppingId = btn.dataset.id;
          const priceInput = document.querySelector(`.topping-price-input[data-id="${toppingId}"]`);
          if (!priceInput) return; // priceInput ì—†ìœ¼ë©´ ë¬´ì‹œ

          const price = priceInput.value;

          const idInput = document.createElement("input");
          idInput.type = "hidden";
          idInput.name = `extraToppings[${idx}].toppingId`;
          idInput.value = toppingId;

          const priceHidden = document.createElement("input");
          priceHidden.type = "hidden";
          priceHidden.name = `extraToppings[${idx}].price`;
          priceHidden.value = price;

          form.appendChild(idInput);
          form.appendChild(priceHidden);
        });
      });
    });
  </script>

</body>
</html>